<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Presence Debug</title>

  <!-- 1. CSS for status dots -->
  <style>
    .status-dot {
      width: 12px; height: 12px;
      border-radius: 50%;
      background: #ccc;
      display: inline-block;
      margin-left: 8px;
      vertical-align: middle;
      transition: background 0.3s;
    }
    .status-dot.online { background: #4CAF50; }
    /* Status badge styling */
    .status-badge {
    display: inline-block;
    font-size: 0.9rem;
    font-weight: bold;
    padding: 0.3rem 0.6rem;
    border-radius: 12px;
    background: #f0f0f0;
    color: #555;
    margin-left: 8px;
    transition: all 0.3s ease;
    }
    
    /* Online state */
    .status-badge.online {
    background: #d4edda;
    color: #155724;
    box-shadow: 0 0 6px rgba(0, 128, 0, 0.2);
    }
  </style>

  <!-- 2. Load Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-database-compat.js"></script>
</head>
<body>

	<div id="statusBox">
	Abir: <span id="myStatus" class="status-badge">🔘 offline</span><br>
	Maria: <span id="herStatus" class="status-badge">🔘 offline</span>
	</div>

  <script>
  let me = localStorage.getItem("userName");
  if (!me) {
  me = prompt("Who are you? Type: abir or maria").toLowerCase();
  if (me !== "abir" && me !== "maria") me = "guest";
  localStorage.setItem("userName", me);
  }
  </script>
  <script>
    console.clear();
    console.log("▶️ Page loaded, firebase:", !!window.firebase);

    // 4. Paste YOUR config here
    const firebaseConfig = {
      apiKey: "AIzaSyDvYjYm6ARxKGetwws8PTiNgcVMzw-A7qw",
      authDomain: "realtime-database-756fa.firebaseapp.com",
      databaseURL: "https://realtime-database-756fa-default-rtdb.firebaseio.com",
      projectId: "realtime-database-756fa",
      storageBucket: "realtime-database-756fa.appspot.com",
      messagingSenderId: "683151708538",
      appId: "1:683151708538:web:f3a8546d8d496c918906c3",
      measurementId: "G-SH2DTKB41G"
    };
    firebase.initializeApp(firebaseConfig);
    console.log("✔️ Firebase initialized");

    // 5. Presence logic
    const db = firebase.database();
    const me    = "abir";      // on the other device change to "maria"
    const other = me === "abir" ? "maria" : "abir";

    console.log("👤 me =", me, "other =", other);

    const myDot  = document.getElementById("myStatus");
    const herDot = document.getElementById("herStatus");

    const conRef   = db.ref(".info/connected");
    const myRef    = db.ref("presence/" + me);
    const theirRef = db.ref("presence/" + other);

    // Watch connection status
    conRef.on("value", snap => {
      console.log(".info/connected =", snap.val());
      if (snap.val()) {
        myRef.set(true);
        myRef.onDisconnect().set(false);
        console.log("→ set presence/" + me + " = true");
      }
      else {
        console.log("→ not connected - presence not updated");
      }
    });

    // Watch the other person’s presence
    theirRef.on("value", snap => {
      console.log(other + " presence snapshot:", snap.val());
      if (snap.val() === true) herDot.classList.add("online");
      else                    herDot.classList.remove("online");
    });
  </script>
</body>
</html>