<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Presence Tester</title>

  <!-- âœ… Status Badge CSS -->
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      text-align: center;
      padding: 3rem 1rem;
      background: linear-gradient(to right, #fff1f5, #fce4ec);
    }
    h1 {
      color: #ff6f91;
      margin-bottom: 2rem;
    }
    .status-badge {
      display: inline-block;
      font-size: 1rem;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      margin-left: 0.5rem;
      background: #e0e0e0;
      color: #333;
      transition: all 0.3s ease;
    }
    .status-badge.online {
      background: #d4edda;
      color: #155724;
      box-shadow: 0 0 6px rgba(0, 128, 0, 0.3);
    }
  </style>

  <!-- âœ… Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-database-compat.js"></script>
</head>
<body>

  <h1>ðŸ’• Real-Time Presence Test</h1>

  <div>
    Abir: <span id="myStatus" class="status-badge">ðŸ”˜ offline</span><br><br>
    Maria: <span id="herStatus" class="status-badge">ðŸ”˜ offline</span>
  </div>

  <!-- âœ… Presence Script -->
  <script>
    // Ask user who they are (abir or maria)
    let me = localStorage.getItem("userName");
    if (!me) {
      me = prompt("Who are you? Type: abir or maria").toLowerCase();
      if (me !== "abir" && me !== "maria") me = "guest";
      localStorage.setItem("userName", me);
    }
    const other = me === "abir" ? "maria" : "abir";

    // âœ… Firebase Config (corrected bucket!)
    const firebaseConfig = {
      apiKey: "AIzaSyC2m1KJJzURXdudtj8PHYXGRPXyHnOjWwg",
      authDomain: "love-presence-demo.firebaseapp.com",
      databaseURL: "https://love-presence-demo-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "love-presence-demo",
      storageBucket: "love-presence-demo.appspot.com",
      messagingSenderId: "1097672159892",
      appId: "1:1097672159892:web:34e1273ad4d2912bc47a81"
    };

    // âœ… Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const myDot = document.getElementById("myStatus");
    const herDot = document.getElementById("herStatus");

    // Firebase presence logic
    const conRef = db.ref(".info/connected");
    const meRef = db.ref("presence/" + me);
    const herRef = db.ref("presence/" + other);

    conRef.on("value", (snap) => {
      if (snap.val()) {
        meRef.set(true);
        meRef.onDisconnect().set(false);
        updateBadge(myDot, true);
        console.log("âœ… Online as", me);
      } else {
        updateBadge(myDot, false);
      }
    });

    herRef.on("value", (snap) => {
      const status = snap.val();
      updateBadge(herDot, status === true);
      console.log("ðŸ‘€", other, "is", status ? "online" : "offline");
    });

    function updateBadge(el, isOnline) {
      if (!el) return;
      el.classList.toggle("online", isOnline);
      el.textContent = isOnline ? "ðŸŸ¢ online" : "ðŸ”˜ offline";
    }
  </script>

</body>
</html>